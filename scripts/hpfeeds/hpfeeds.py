#!/usr/bin/python
import json
from subprocess import PIPE, STDOUT
from subprocess import Popen, call
import sys,time
from socketIO_client import SocketIO

if __name__ == '__main__' :
    sys.path.append('./bin/lib/')

    HPFRIENDS='hpfeeds-client'

    accountFile = open('hpfriends.json', 'r')
    account = json.load(accountFile)

    cmd = [HPFRIENDS,
           '-i', account['user'],
           '-s', account['pass'],
           '--host', account['host'],
           '-p', account['port'],
           '-c', account['capture'],
           account['action']]

    #call(cmd)`
    #pHpf=Popen(cmd, stdout=PIPE, stderr=STDOUT)
    #while True:
    #    s = pHpf.stdout.read()
    #    if s is not None:
    #        print '> ', s#


    #    time.sleep(0.1)

    #print 'cmd: ', cmd

    socketIO = SocketIO('127.0.0.1', 8000)
    chatSocket = socketIO.connect('/new-event')

    i=0
    while True:
        i += 1
        chatSocket.emit('update', {'x': (40 + i)%100, 'y': 40})
        time.sleep(1.5)
        print 'update sent.'

    #socketIO.emit('aaa', {'bbb': 'ccc'})
    socketIO.wait()