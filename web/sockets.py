from socketio.namespace import BaseNamespace
from socketio.mixins import RoomsMixin, BroadcastMixin
from socketio.sdjango import namespace

@namespace('/chat')
class ChatNamespace(BaseNamespace, RoomsMixin, BroadcastMixin):
    def on_chat(self, msg):
        print 'on_chat: ', msg
        self.emit('welcome', msg)

    def on_subscribe(self, msg):
        print 'on_subscribe: ', msg
        self.emit('test', msg)

clientId = 0

@namespace('/new-event')
class NewEventNamespace(BaseNamespace, BroadcastMixin):
    def on_subscribe(self, msg):
        global clientId

        print 'new client: ', msg
        self.emit('welcome', {'id': clientId})
        clientId += 1

    def on_update(self, msg):
        print 'new data from hpfeeds: ', msg
        self.broadcast_event_not_me('news', msg)

    def __informClients(self, msg):
        self.broadcast_event_not_me('new-event', msg)